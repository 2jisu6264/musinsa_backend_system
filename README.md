# 무료 포인트 시스템 API 과제
포인트 적립 / 적립취소 / 사용 / 사용취소 기능을 제공하는 서비스입니다.  
포인트 정책 변경 가능성, 만료 처리, 주문 단위 사용 이력 추적을 고려하여 설계하였습니다.

## 1. 과제 목표
- 포인트 적립/사용에 대한 트랜잭션 처리
- 정책 값 하드코딩 제거
- 만료 포인트 및 사용 취소 시나리오 대응
- 주문 단위 포인트 사용 이력 추적

## 2. 기술 스택

- Java 21
- Spring Boot
- Spring Data JPA (Hibernate)
- Gradle
- H2 / MySQL

---

## 3. 기능 설명

### 4.1 포인트 적립

#### 요구사항
1. 1회 적립 가능 포인트는 "1포인트 이상, 100,000포인트 이하"
2. 개인별 최대 보유 포인트 한도가 존재
3. 특정 시점에 적립된 포인트가 "어떤 주문에서 사용되었는지 추적 가능"
4. 관리자 수기 지급 (MU) , 자동지급 (AU) 로 지급한 포인트 구분
5. 모든 포인트는 만료일을 가지며
    - 최소 1일 이상
    - 최대 5년 미만 (기본 365일)
   
#### 구현 방식
- 적립 금액 및 보유 한도는 `PointPolicy` 테이블을 통해 유연하게 설정 가능하도록 설계
- 적립 시 'PointWallet` 생성 (만료일 단위 관리)
- 적립 이력은 `PointLog`에 기록
- 관리자가 수기로 지급한 포인트는 별도로 식별 가능하도록 관리합니다. `WalletSourceType`으로 구분 (AU/MA)

---

### 4.2 포인트 적립 취소

#### 요구사항
1. 특정 적립 행위에서 적립한 금액만 취소 가능
2. 적립 금액 중 일부라도 사용된 경우 '적립 취소 불가'

#### 구현 방식
- 적립 취소 시 wallet 단위로 처리
- `usedAmount > 0` 인 wallet은 취소 불가
- 취소 시 wallet 상태를 비활성화 처리 (`wallet_status = '10'`)
- 회원 잔액 차감 및 취소 로그 기록

---

### 4.3 포인트 사용

#### 요구사항
1. 주문 시에만 포인트 사용 가능
2. 주문번호와 함께 포인트 사용 이력 기록
3. 관리자 수기 지급 포인트 우선 사용
4. 만료일이 가까운 포인트부터 사용

#### 구현 방식
- 주문번호 생성 후 포인트 사용 승인 처리
- 사용 순서:
    1. 관리자 수기 지급 포인트 우선
    2. 만료일 오름차순
- 실제 사용 가능 금액 계산:

---

## 5. 거래 구분 코드 및 오류 코드 설계

### 5.1 거래 구분 코드 관리 (Enum 기반)

포인트 적립/사용/취소 거래 유형은 'PointLogType' Enum 기반의 거래 구분 코드로 관리합니다.

## 6. 오류 코드 관리 방식

오류 코드는 Enum(`ProcessCode`)으로 관리하여 다음과 같은 장점을 제공합니다.

- 문자열 하드코딩 없이 코드 수준에서 오류 유형을 관리
- 오류 코드 중복 및 불일치 방지
- 메시지 변경 시 코드 영향 없이 메시지 수정 가능
- 서비스 전반에 걸쳐 일관된 오류 응답 구조 유지

### 6.1 오류 코드 설계 (MP Prefix)
본 프로젝트에서는 무신사 무료 포인트 시스템의 도메인 특성을 명확히 드러내기 위해  
오류 코드에 `MP` Prefix를 사용하여 관리합니다.

- `MP` : Musinsa Point 도메인 식별자
- 뒤 3자리 숫자 : 오류 유형 구분

이를 통해 포인트 관련 오류를 공통 오류와 명확히 분리하고,  
로그 분석 및 운영 대응 시 오류 원인을 빠르게 식별할 수 있도록 설계했습니다.

